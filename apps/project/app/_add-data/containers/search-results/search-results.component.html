<div class="results-header">
  <table>
    <thead>
      <tr>
        <th class="growing-cell text-center">Title</th>
        <th class="fixed-cell">Country</th>
        <th class="fixed-cell">Weighting</th>
        <th class="fixed-cell">Base 50th</th>
        <th class="fixed-cell">TCC 50th</th>
        <th class="fixed-cell">Matches</th>
      </tr>
    </thead>
  </table>
</div>

<div #results
     class="results"
     infinite-scroll
     [scrollWindow]="false"
     [infiniteScrollDistance]="3"
     (scroll)="handleResultsScroll()"
     (scrolled)="onScroll()">

    <pf-async-container
      [loading]="loadingResults$ | async"
      [loadingError]="error$ | async"
      [hideReloadButton]="true">

      <table *ngIf="(jobResults$ | async)?.length; else noResultsMessage">
        <tbody>
          <tr>
            <td colspan="6">
              <table *ngFor="let jobResult of jobResults$ | async;trackBy: trackByJobId; index as tooltipIndex"
                     pf-job-result
                     [job]="jobResult"
                     [currencyCode]="(jobContext$ | async)?.CurrencyCode"
                     (jobTitleClick)="handleJobTitleClick($event, tooltipIndex)"
                     (showCutsClick)="handleShowCutsClick($event)"
                     (cutSelected)="handleCutSelectionToggle($event)">
              </table>
            </td>
          </tr>
          <tr class="loading-more-row" *ngIf="loadingMoreResults">
            <td colspan="6"><pf-loading-indicator></pf-loading-indicator> Loading More Results...</td>
          </tr>
        </tbody>
      </table>

    </pf-async-container>

  </div>

<ng-template #noResultsMessage>
  <div *ngIf="!(loadingResults$ | async)" class="no-results-message-container">
    No results. Please change your filter criteria and search again.
  </div>
</ng-template>

<pf-job-details-tooltip
  *ngIf="tooltipData"
  [job]="tooltipData.Job"
  [tooltipLeftPx]="tooltipData.TargetX"
  [tooltipTopPx]="tooltipData.TargetY"
  [visible]="tooltipOpen$ | async"
  [containerHeight]="resultsContainerHeight"
  [containerWidth]="resultsContainerWidth"
  (closed)="clearTooltip()"
  pfClickElsewhere [whitelist]="['job-title']" (clickElsewhere)="clearTooltip()">
</pf-job-details-tooltip>
