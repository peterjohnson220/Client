<div class="company-job-to-map-to-result d-flex flex-column">

  <div class="d-flex justify-content-between">

    <div class="d-flex flex-column">
      <strong>{{companyJobToMapTo.JobCode}} - {{companyJobToMapTo.JobTitle}}</strong>

      <div class="mt-2">

        <ng-container
          *ngIf="companyJobToMapTo.JobDescription && companyJobToMapTo.JobDescription.length; else noJobDescription">

          <ng-container
            *ngIf="!showFullJobDescription && companyJobToMapTo.JobDescription.length > jobDescriptionMaxLength; else fullJobDescription">
            {{companyJobToMapTo.JobDescription.substr(0, jobDescriptionMaxLength) + '...'}}
          </ng-container>

          <ng-template #fullJobDescription>
            {{companyJobToMapTo.JobDescription}}
          </ng-template>

          <div *ngIf="companyJobToMapTo.JobDescription.length > jobDescriptionMaxLength"
               class="toggle-jd-view-link"
               (click)="showFullJobDescription = !showFullJobDescription">

            View {{showFullJobDescription ? 'Less' : 'More'}}

          </div>

        </ng-container>

        <ng-template #noJobDescription>
          <em>No Job Description</em>
        </ng-template>
      </div>

    </div>

    <div class="apply-mapping-container">
      <button *ngIf="!companyJobToMapTo.Mapped && ((applyingMapping && selectedMapping) || (!applyingMapping))"
              class="btn btn-sm btn-outline-primary"
              [ngClass]="{
                'btn-outline-primary': !selectedMapping || applyingMappingError,
                'btn-primary': selectedMapping && !applyingMappingError
               }"
              (click)="handleApplyMappingClicked(companyJobToMapTo.CompanyJobId)">

        <span *ngIf="(!applyingMapping && !applyingMappingError) || (applyingMappingError && !selectedMapping)">
          Apply Mapping
        </span>

        <span *ngIf="applyingMappingError && selectedMapping">
          Retry
        </span>

        <span *ngIf="applyingMapping">
          <pf-loading-indicator></pf-loading-indicator> Applying Mapping...
        </span>

      </button>

      <button *ngIf="companyJobToMapTo.Mapped && (!applyingMapping)"
              type="button"
              class="btn btn-sm btn-outline-dark"
              disabled>
        Mapped
      </button>

      <span *ngIf="applyingMappingError && selectedMapping" class="error-applying-message text-danger">
        <i class="fal fa-exclamation-triangle"></i> Error Applying Mapping
      </span>
    </div>
  </div>

</div>
