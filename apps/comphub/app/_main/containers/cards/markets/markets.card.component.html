<pf-card-layout
  pageTitle="Markets"
  pageSubTitle="Now, let's define the market"
  pageIconClass="fa-map-marker-alt"
  [nextButtonEnabled]="true">

  <ng-container page-content>
    <pf-add-paymarket-form *ngIf="addPayMarketFormOpen$ | async"
      [isOpen]="addPayMarketFormOpen$ | async"
      [isInfoBannerOpen]="infoBannerOpen$ | async"
      [marketDataScope]="marketDataScope$ | async"
      [saving]="savingPayMarket$ | async"
      [savingConflict]="savingPayMarketConflict$ | async"
      [savingError]="savingPayMarketError$ | async"
      [showSkipButton]="showSkipButton$ | async"
      (saveClick)="handleSavePayMarket($event)"
      (skipClick)="handleSkipAddPayMarket()"
      (cancelClick)="handleCancelAddPayMarket()"
      (dismissInfoBannerClick)="handleDismissInfoBanner()">
    </pf-add-paymarket-form>
  </ng-container>

  <ng-container page-content>

    <pf-async-container
      [loading]="loadingPaymarkets$ | async"
      [loadingError]="loadingPaymarketsError$ | async"
      [loadingErrorMessage]="'Error.'"
      [hideReloadButton]="true">

      <div class="row"
        *ngIf="(paymarkets$ |async).length && !(addPayMarketFormOpen$ | async)">
        <div class="col-lg-12 col-xl-9">
          <div class="search-filter">
            <span class="k-textbox k-space-right">
                    <input type="text"
                           [(ngModel)]="searchTerm"
                           (keyup)="handleSearchChanged($event.target.value)"
                           [attr.data-qa-id]="'txt-search-paymarkets'"
                           [placeholder]="'Search Pay Markets...'"
                           class="k-widget k-input search-paymarkets"/>
                    <span (click)="clearSearchValue()"
                          [class.k-i-close]="searchTerm"
                          class="k-icon k-clear-value"></span>
                </span>
          </div>

          <div class="add-new-market-container">
            <span class="uppercase-header">My Markets</span>
            <div class="add-new-market-button"
              [attr.data-qa-id]="'btn-addNewMarket'"
              (click)="handleAddNewMarketClicked()">
              <i class="fa fa-plus-circle"></i>
              Add New Market
            </div>
          </div>

          <pf-select-paymarkets
            *ngIf="(visiblePaymarkets$ |async).length"
            [selectedPaymarketId]="(selectedPaymarket$ | async)?.CompanyPayMarketId"
            [paymarkets]="visiblePaymarkets$ | async"
            (paymarketChecked)="handlePaymarketChecked($event)">
          </pf-select-paymarkets>

          <div *ngIf="!(visiblePaymarkets$ | async).length && !(loadingPaymarkets$ | async)">
            <div class="no-data">No Data</div>
          </div>
        </div>
      </div>


    </pf-async-container>
  </ng-container>

</pf-card-layout>
