<pf-async-container [loading]="upsertingDataCut$ | async"
                    [loadingError]="upsertingDataCutError$ | async"
                    [loadingErrorMessage]="'Error adding data cut, please close the modal and try again.'"
                    [hideReloadButton]="true">

  <div class="d-flex h-100 w-100">
    <div class="filters-container">
      <pf-peer-data-cut-filter-sidebar [companyPayMarketId]="companyPayMarketId"
                                       [shouldShowPayMarketBoundsFilter]="hasAcceptedPeerTerms$ | async"
                                       [shouldShowExchangeScopeSelector]="hasAcceptedPeerTerms$ | async">
      </pf-peer-data-cut-filter-sidebar>
    </div>
    <div class="flex-grow-1 d-flex flex-column h-100 w-100">
      <div class="map-container flex-grow-1 d-flex flex-column">
        <pf-peer-data-cut-map *ngIf="systemFilter$ | async"
                              [canFitBounds]="upsertDataCutPageInViewInIframe$ | async">
        </pf-peer-data-cut-map>
        <div class="alert alert-mustard mb-0"
             *ngIf="!(hasAcceptedPeerTerms$ | async)">
          <div class="request-access-message mb-2">
            {{!(hasRequestedPeerAccess$ | async) ? requestPeerAccessMessage : accessRequestedMessage }}
          </div>
          <div class="d-flex justify-content-end mt-0">
            <button type="button"
                    class="btn btn-primary mr-2"
                    [disabled]="(requestingPeerAccess$ | async) || (hasRequestedPeerAccess$ | async)"
                    (click)="requestPeerAccess()">
              <span *ngIf="requestingPeerAccess$ | async">
                <pf-loading-indicator></pf-loading-indicator> Requesting Access...
              </span>
              <span *ngIf="!(requestingPeerAccess$ | async)">
                {{(hasRequestedPeerAccess$ | async) ? 'Access Requested' : 'Request Access'}}
              </span>
            </button>
            <button type="button"
                    class="btn btn-secondary"
                    (click)="cancel()">Cancel</button>
          </div>
        </div>
      </div>
      <div class="button-container d-flex flex-row justify-content-between align-items-center"
           *ngIf="(hasAcceptedPeerTerms$ | async)">
        <div class="d-flex"
             *ngIf="((untaggedIncumbentCount$ | async) > 0)">

          <label for="include-untagged-incs">
            Include {{untaggedIncumbentCount$ | async | number }} non geotagged employees
            that do not have location data?

            <input id="include-untagged-incs"
                   type="checkbox"
                   [ngModel]="includeUntaggedIncumbents$ | async"
                   (click)="handleUntaggedIncumbentsChecked()">
          </label>
        </div>
        <div class="d-flex flex-grow-1 justify-content-end ">
          <label style="font-style: italic;"
                 class="text-muted"
                 *ngIf="(isEmployeeCheckLoading$ | async)">
            <i class='fa fa-spinner fa-spin'></i>&nbsp;<b>Validating...</b>
          </label>
        </div>
        <div class="flex-grow-1 d-flex justify-content-end">
          <pf-guidelines-badge *ngIf="(initialMapMoveComplete$ | async)">
          </pf-guidelines-badge>

          <div class="buttons">
            <button type="button"
                    class="btn btn-primary btn-primary-legacy"
                    *ngIf="(hasAcceptedPeerTerms$ | async)"
                    [disabled]="failsGuidelines || !(hasAcceptedPeerTerms$ | async) || (isEmployeeCheckLoading$ | async)"
                    (click)="upsert()">

              {{primaryButtonText}}
            </button>

            <button type="button"
                    class="btn btn-secondary"
                    (click)="cancel()">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

</pf-async-container>