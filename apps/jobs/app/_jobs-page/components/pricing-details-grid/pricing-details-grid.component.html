<pf-data-grid
  *ngIf="viewMode === 'Priced'"
  [pageViewId]="pricedDataPageViewId"
  [showTitle]="false"
  [showColumnChooser] ="false"
  [showFilterChooser] ="false"
  [allowExport]="false"
  [contentNoPadding]="true"
  [selectionField]="'CompanyJobPricing_ID'"
  [enableSelection]="true"
  [columnTemplates]="colTemplates"
  [applyDefaultFilters]="false"
  [expandedRowTemplate]="pricingMatchesGrid"
  [inboundFilters]="filters"
  [defaultSort]="defaultSort"
  [showActionBar]="true"
  [actionBarClassName]="'pricing-details-grid-action-bar ml-0 mt-1'"
  [gridGlobalFiltersTemplates]="globalFilterTemplates"
  [gridGlobalActionsTemplate]="changeView"
  [headerClassName]="'pricing-details-grid-header'"
  [noRecordsFound]="'No Pay Markets priced for this job. Click &quot;Pay Markets not Priced&quot; above to view and select Pay Markets to price.'">
</pf-data-grid>

<pf-data-grid
  *ngIf="viewMode === 'Not Priced'"
  [pageViewId]="notPricedDataPageViewId"
  [showTitle]="false"
  [showColumnChooser] ="false"
  [showFilterChooser] ="false"
  [allowExport]="false"
  [contentNoPadding]="true"
  [selectionField]="'JobIdPayMarketId'"
  [enableSelection]="true"
  [inboundFilters]="filters"
  [defaultSort]="defaultSort"
  [showActionBar]="true"
  [gridGlobalActionsTemplate]="changeView"
  [actionBarClassName]="'pricing-details-grid-action-bar ml-0 mt-1'"
  [headerClassName]="'pricing-details-grid-header'"
  [noRecordsFound]="'All Pay Markets Priced'">
</pf-data-grid>

<ng-template #pricingMatchesGrid let-dataRow="dataRow">
  <pf-pricing-matches-grid [pricingInfo]="dataRow"></pf-pricing-matches-grid>
</ng-template>

<ng-template #payMarketColumn let-dataRow="dataRow">
  <b>{{dataRow['CompanyPayMarkets_PayMarket']}}</b>

  <span placement="right" *ngIf="dataRow['CompanyPayMarkets_Linked_PayMarket_Name']" data-html="true"
        ngbTooltip="This pay market is linked to {{dataRow['CompanyPayMarkets_Linked_PayMarket_Name']}}.">
    <fa-icon class="pl-2" icon="link">
    </fa-icon>
  </span>
  <br>
  <small>
    <em class="text-muted">
      Industry: {{dataRow['CompanyPayMarkets_Industry_Value'] || 'N/A' }}
      &#8226;
      Size: {{dataRow['CompanyPayMarkets_Size_Value'] || 'N/A'}}
      {{dataRow['CompanyPayMarkets_Size_Label'] ? ' - ' + dataRow['CompanyPayMarkets_Size_Label'] : ''}}
      &#8226;
      Location: {{dataRow['CompanyPayMarkets_Geo_Value'] || 'N/A'}}
    </em>
  </small>
</ng-template>

<ng-template #baseMrpColumn let-dataRow="dataRow">
  <span [innerHTML]="dataRow['CompanyJobs_Pricings_BaseMRP'] | comp: dataRow['CompanyJobs_Pricings_Rate'] | emptyPlaceholder"></span>
  <small *ngIf="dataRow['CompanyJobs_Pricings_BaseMRP']">
    <em class="text-muted">
      ({{dataRow['CompanyJobs_Pricings_Base_reference_Point']}}th)
    </em>
  </small>
</ng-template>

<ng-template #baseTccColumn let-dataRow="dataRow">
  <span [innerHTML]="dataRow['CompanyJobs_Pricings_TCCMRP'] | comp: dataRow['CompanyJobs_Pricings_Rate'] | emptyPlaceholder"></span>
  <small *ngIf="dataRow['CompanyJobs_Pricings_TCCMRP']">
    <em class="text-muted">
      ({{dataRow['CompanyJobs_Pricings_TCC_Reference_Point']}}th)
    </em>
  </small>
</ng-template>

<ng-template #currencyColumn let-dataRow="dataRow" let-fieldName="fieldName">
  <span [innerHTML]="dataRow[fieldName] | comp: dataRow['CompanyJobs_Pricings_Rate'] | emptyPlaceholder"></span>
</ng-template>

<ng-template #payMarketFilter>
      <kendo-dropdownlist
        style="width: 250px"
      [(ngModel)]="selectedPayMarket"
      [textField]="'Value'"
      [valueField]="'Id'"
      [defaultItem]="{Value:'All Pay Markets', Id: null}"
      [data]="filteredPayMarketOptions"
      (valueChange)="handlePayMarketFilterChanged($event)"
      [filterable]="true"
      (filterChange)="handleFilter($event)"
      [attr.data-qa-id]="'ddm-operator-'+payMarketField.SourceName"
      class="k-dropdown-white form-control"
    >
    </kendo-dropdownlist>
</ng-template>

<ng-template #changeView>
  <div (click)="viewMode === 'Priced' ? viewMode = 'Not Priced' : viewMode = 'Priced'">
    <div class="pricing-count-badge">
      <span class="badge badge-primary mr-2">{{viewMode === 'Priced' ? unPricedCount : pricedCount}}</span>
      <span *ngIf="viewMode === 'Priced' ? unPricedCount > 1 : pricedCount > 1">{{viewMode === 'Priced' ? 'Pay Markets Not Priced' : 'Priced Pay Markets'}}</span>
      <span *ngIf="viewMode === 'Priced' ? unPricedCount === 1 : pricedCount === 1">{{viewMode === 'Priced' ? 'Pay Market Not Priced' : 'Priced Pay Market'}}</span>
    </div>
  </div>
</ng-template>

