<pf-async-container [loading]="(jobInsightsAsync$ | async)?.loading">
  <div class="p-3 job-insights-container">
    <div class="d-flex flex-column">
      <div class="d-flex pb-4 flex-wrap">
        <div class="d-flex flex-grow-1">
          <div>
            <kendo-dropdownlist
              [attr.data-qa-id]="'ddm-job-insights-paymarket'"
              [data]="payMarkets"
              [textField]="'PayMarket'"
              [valueField]="'CompanyPayMarketId'"
              [kendoDropDownFilter]="filterSettings"
              [valuePrimitive]="true"
              [ngModel]="companyPayMarketId"
              [style.width.px]="250"
              class="k-dropdown-white"
              (valueChange)="handlePayMarketValueChanged($event)">
              <ng-template kendoDropDownListItemTemplate let-dataItem>
                <div pfEllipsisActive class="ellipsis-overflowing-text">
                  <span>{{ dataItem.PayMarket }}</span>
                </div>
              </ng-template>
            </kendo-dropdownlist>
          </div>
          <div class="d-flex flex-grow-1"></div>
        </div>
      </div>
      <ng-container *ngIf="jobInsights?.JobSummary?.length">
        <div class="card mb-3">
          <div class="card-body">
            <pf-job-insights-job-summary [mode]="jobInsightsEditMode"
                                         [jobSummary]="jobInsights.JobSummary">
            </pf-job-insights-job-summary>
          </div>
        </div>
      </ng-container>
      <ng-container>
        <div class="card mb-3">
          <div class="card-body">
            <span class="title">Pricing Details</span>
            <div class="graph-container">
              <pf-job-pricing-base-graph [paymarketId]="companyPayMarketId" [companyJobId]="companyJobId"></pf-job-pricing-base-graph>
              <pf-job-pricing-tcc-graph [paymarketId]="companyPayMarketId" [companyJobId]="companyJobId"></pf-job-pricing-tcc-graph>
            </div>
            <div class="card mb-3">
              <div>
                <div class="d-flex">
                  <div class="title p-3 flex-fill">Market Data</div>
                  <div class="d-flex align-items-center pr-3">
                    <button [pfSecuredResource]="permissions.MODIFY_PRICINGS"
                            type="button"
                            class="btn btn-add-data"
                            (click)="openAddDataModal()">
                      Add Data
                    </button>
                  </div>
                </div>
                <pf-market-data [jobPricing]="jobPricing" (marketDataUpdated)="handleMarketDataUpdated()" (reloadJobPricing)="handlePricingChanged()"></pf-market-data>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
      <ng-container *ngIf="jobInsights">
        <div class="card mb-3">
          <div class="card-body">
            <pf-job-insights-job-details [mode]="jobInsightsEditMode"
                                         [standardFields]="standardFields"
                                         [customFields]="customFields">
            </pf-job-insights-job-details>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</pf-async-container>

<pf-add-data
  [display]="'modal'"
  [featureImplementation]="modifyPricingFeatureImplementation"
  [showSubmit]="true">
</pf-add-data>
