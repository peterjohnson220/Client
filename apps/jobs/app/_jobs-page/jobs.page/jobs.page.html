<pf-data-grid
  [pageViewId]="pageViewId"
  [title]="getPageTitle(company$ | async)"
  [navigationURL]="'/client/dashboard'"
  [selectionField]="'CompanyJob_ID'"
  [gridActionsTemplate]="gridActions"
  [columnTemplates]="colTemplates"
  [showFilterChooser]="true"
  [allowExport]="false"
  [defaultSort]="defaultSort"
  [enableSelection]="true"
  [splitViewTemplate]="jobsDetails"
  [gridGlobalFiltersTemplate]="globalFilters">
</pf-data-grid>

<ng-template #jobStatusColumn let-dataRow="dataRow">
  {{dataRow['CompanyJobs_JobStatus'] ? 'Active' : 'Inactive'}}
</ng-template>

<ng-template #jobsDetails let-splitViewEmitter="splitViewEmitter" let-splitViewFilters="splitViewFilters">
  <pf-jobs-details
    [jobDetailsFilters]="splitViewFilters"
    (onClose)="splitViewEmitter.emit('close')">
  </pf-jobs-details>
</ng-template>

<ng-template #gridActions>
  <button [pfSecuredResource]="permissions.NEW_PROJECT" [attr.data-qa-id]="'btn-addJobsToProject'" type="button" [disabled]="!selectedKeys || selectedKeys.length==0"  (click)="addJobsToProject()" class="btn btn-link">
  <span *ngIf="!(addingToProject$ | async)">
  <fa-icon icon="calculator"></fa-icon>
    Add
    <span *ngIf="selectedKeys?.length == 1"> Job</span>
    <span *ngIf="selectedKeys?.length > 1"> ({{selectedKeys?.length}}) Jobs</span>
    to Project
  </span>
  </button>
</ng-template>

<pf-modal-form
  [modalId]="'au-modal-add-jobs-to-project'"
  [isOpen$]="addingToProject$"
  [size]="'md'"
  [submitting]="false"
  [showFooter]="false"
  [centered]="true"
  [allowDismiss]="false"
  [title]="'Add Jobs to Project'"
>
  <ng-container basic-content>
    <h4 class="text-center pb-3 pt-3">
      <fa-icon icon="spinner" spin="true"> </fa-icon>
      We are adding the selected
      <span *ngIf="selectedKeys?.length == 1"> job</span>
      <span *ngIf="selectedKeys?.length > 1"> jobs</span>
      to a Project
    </h4>
  </ng-container>
</pf-modal-form>

<ng-template #globalFilters>
  <pf-input-debounce
    [placeholderText]="'Search for a Job Title or Code...'"
    [hideClearBtn]="false"
    [minWidth]="300"
    [delay]="400"
    [ngModel]="titleCodeSearchField?.FilterValue"
    (valueChanged)="handleTitleCodeSearch($event)"></pf-input-debounce>
</ng-template>
