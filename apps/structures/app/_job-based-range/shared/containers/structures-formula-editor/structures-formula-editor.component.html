<div class="form-group no-margin-bottom" [formGroup]="structuresFormulaForm">
    <div class="form-group row">
        <div class="input-group">
          <input type="text" class="form-control" [placeholder]="'Formula Name'" [value]="formulaFieldObj.FieldName" [maxlength]="maxFieldNameLength"
            (change)="handleFormulaNameChange()" [ngClass]="{ 'is-invalid': attemptedSubmit && formControls.FieldName.invalid }"
            [pfValidatable]="true" ngbAutoFocus formControlName="FieldName" name="FormulaName"/>
        </div>
        <span *ngIf="attemptedSubmit && (formControls.FieldName.hasError('required') || formControls.FieldName.hasError('minLength'))" class="text-danger">Formula name required.</span>
    </div>
    <div class="form-group row">
      <div class="instructions">
        Use <b>[</b> to find and insert existing fields in your formula. Use <b>$</b> to view formula syntax.
      </div>
    </div>
    <div class="form-group no-margin-bottom row">
      <div *ngIf="attemptedSubmit && !formulaFieldObj.Formula">
        <span class="text-danger">Formula required.</span>
      </div>
      <div class="input-group">
        <pf-formula-editor
        [initialFormula]="formula"
        [fieldSuggestions]="fieldSuggestions"
        [functionSuggestions]="functionSuggestions"
        [validating]="validating"
        [isValid]="isValidFormula"
        [disabled]="!isEditable"
        [isWaitingForValidation]="isWaitingForValidation"
        (formulaChanged)="handleFormulaChanged($event)">
        </pf-formula-editor>
      </div>
      <div *ngIf="(saveFormulaFieldError$ | async)">
        <span class="text-danger">{{(savingErrorMessage$ | async)}}</span>
      </div>
    </div>
</div>
