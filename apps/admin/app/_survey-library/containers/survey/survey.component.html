<pf-page-with-title-bar>
  <ng-container page-title>
    {{pageTitle}}
  </ng-container>

  <ng-container page-content>
    <pf-input-debounce [delay]="400"
                       [(ngModel)]="tbxSearch"
                       (valueChanged)="handleSearchChanged()"
                       (clearClicked)="tbxSearch = ''">
    </pf-input-debounce>
    <pf-async-container [loading]="isLoadingData$ | async"
                        [loadingError]="hasLoadingError$ | async"
                        [loadingErrorMessage]="'Failed to get survey data'">


      <table class="table table-hover">
        <thead>
          <tr>
            <th *ngIf="isUserGroupOne()">Survey</th>
            <th>Company</th>
            <th>ID</th>
            <th>Code</th>
            <th># Jobs</th>
            <th># Data Cuts</th>
            <th># Participants</th>
            <th># Published Matches</th>
            <th># Project Matches</th>
            <th>Map Companies</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of surveys">
            <td *ngIf="isUserGroupOne()">{{item.SurveyName}}</td>
            <td>{{item.CompanyName}}</td>
            <td>{{item.SurveyId}}</td>
            <td>{{item.SurveyCode}}</td>
            <td>{{item.JobCount}}</td>
            <td>{{item.CutCount}}</td>
            <td>{{item.ParticipantCount}}</td>
            <td>{{item.PublishMatchCount}}</td>
            <td>{{item.ProjectMatchCount}}</td>
            <td (click)="mapCompaniesClick(item.SurveyId)"
                style="cursor: pointer"><u>{{item.CompanyCount}}</u></td>
            <td>
              <button type="button"
                      class="btn btn-info btn-sm"
                      (click)="copySurvey(item.SurveyId, item.SurveyName)">
                Copy Survey
              </button>
              <ng-container *ngIf="isUserGroupOne()">
                &nbsp;
                <button type="button"
                        class="btn btn-danger btn-sm"
                        *ngIf="item.PublishMatchCount === 0 && item.ProjectMatchCount === 0 && item.JobCount > 0"
                        (click)="deleteSurveyData(item.SurveyId)">
                  Delete Data Cuts
                </button>
                &nbsp;
                <button type="button"
                        class="btn btn-danger btn-sm"
                        *ngIf="item.JobCount === 0 && item.CutCount === 0"
                        (click)="deleteSurvey(item.SurveyId)">
                  Delete Survey
                </button>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </pf-async-container>
    <button *ngIf="isUserGroupOne()"
            type="button"
            class="btn btn-sm"
            (click)="addSurvey()">Add Survey</button>
    &nbsp;
    <button type="button"
            class="btn btn-sm"
            (click)="backToSurveyYear()">Back to Survey Years</button>

  </ng-container>
</pf-page-with-title-bar>
<pf-add-survey-modal [surveyYearId]="surveyYearId">
</pf-add-survey-modal>
<pf-map-company-modal [surveyId]="selectedSurveyId">
</pf-map-company-modal>
<pf-copy-survey-modal [surveyId]="selectedSurveyId"
                      [SurveyName]="selectedSurveyName">
</pf-copy-survey-modal>