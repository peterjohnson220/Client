<pf-page-with-title-bar [isFullHeader]="showTitle" [absoluteUrl]="navigationURL" [contentNoPadding]="contentNoPadding">
  <ng-container page-title *ngIf="showTitle">
    {{title | titlecase}}
  </ng-container>
  <ng-container page-actions>
    <pf-action-bar
      [pageViewId]="pageViewId" class="flex-fill"
      [showColumnChooser]="showColumnChooser"
      [showFilterChooser]="showFilterChooser"
      [allowExport]="allowExport"
      [globalFilterAlignment]="showTitle?'Right':'Left'"
      [globalActionsTemplate]="gridGlobalActionsTemplate"
      (onFilterSidebarToggle)="toggleFilterPanel()">
    </pf-action-bar>
  </ng-container>
  <ng-container page-content>

    <div class="d-flex h-100">
      <div [ngClass]="(selectedRowId$ | async) ? 'main-grid-container-compact' : 'full-size-wrapper'">
        <div class="flex-column-container">
          <div *ngIf="gridActionsTemplate || userFilteredFields.length>0" class="no-gutters row justify-content-between pl-2 border border-top-1 gridActionTemplate">
            <div class="flex-fill p-1">
              <div class="h-100" *ngIf="userFilteredFields.length > 0">
                <pf-data-grid-filter-pills
                  [fields]="userFilteredFields"
                  (clearFilter)="clearFilter($event)"
                  (clearAllFilters)="clearAllFilters()">
                </pf-data-grid-filter-pills>
              </div>
            </div>
            <div *ngIf="gridActionsTemplate && !(selectedRowId$ | async)" class="d-flex justify-content-end">
              <ng-container [ngTemplateOutlet]="gridActionsTemplate"></ng-container>
            </div>
          </div>
          <div class="d-flex h-100">
            <div class="full-size-wrapper">
              <div class="grid-container">
                <pf-grid
                  [pageViewId]="pageViewId"
                  [selectionEntityName]="(baseEntity$ | async)?.SourceName"
                  [selectionField]="selectionField"
                  [allowSplitView]="splitViewTemplate"
                  [columnTemplates]="columnTemplates"
                  [enableSelection]="enableSelection && !(selectedRowId$ | async)"
                  [selectedRowId]="selectedRowId$ | async">
                </pf-grid>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="selectedRowId$ | async" class="sub-grid-container">
        <ng-container
          [ngTemplateOutlet]="splitViewTemplate"
          [ngTemplateOutletContext]="{splitViewEmitter: splitViewEmitter, splitViewFilters: splitViewFilters$ | async}">
        </ng-container>
      </div>
      <div *ngIf="displayFilterPanel$ | async" class="sidebar-filter-container px-3 border border-top-1">
        <pf-filter-panel
          [fields]="filterableFields$ | async"
          (close)="closeFilterPanel()"
          (filterChanged)="handleFilterChanged($event)"

          (filterCleared)="clearFilter($event)"
          (saveFilterClicked)="saveFilterClicked()">
        </pf-filter-panel>
      </div>
    </div>

    <pf-data-grid-save-view-modal
      [savedViews]="(savedViews$ | async)"
      [modalOpen$]="saveViewModalOpen$"
      [saving]="(viewIsSaving$ | async)"
      (saved)="saveFilterHandler($event)"
      (closed)="closeSaveViewModal()">
    </pf-data-grid-save-view-modal>
  </ng-container>
</pf-page-with-title-bar>

