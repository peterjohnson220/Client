<pf-async-container [loading]="loading$ | async">
  <kendo-grid
    [data]="data$ | async"
    [pageSize]="(pagingOptions$ | async)?.Count"
    [skip]="(pagingOptions$ | async)?.From"
    [pageable]="getPagingBarConfig(gridState$ | async)"
    [scrollable]="isMultiplePages(gridState$ | async)"    
    [resizable]="selectedRowId ? false : true"    
    [sortable]="{ 
      allowUnsort: 'true',
      mode: 'single'
    }"
    [sort]="sortDescriptor$ | async"
    [rowClass]="selectedRowClass"
    (pageChange)="onPageChange($event)"
    (sortChange)="onSortChange($event)"
    (cellClick)="onCellClick($event)">
    <ng-container *ngFor="let col of (dataFields$ | async)">
      <ng-container *ngIf="col.Group">
          <kendo-grid-column-group 
            [title]="col.Group"
            [headerClass]="'pf-data-grid-header'"
            [locked]="false">
              <ng-container *ngFor="let col of col.Fields">
                  <ng-container *ngIf="showColumn(col)">
                      <kendo-grid-column 
                        [field]="mappedFieldName(col)"
                        [title]="col.DisplayName"
                        [headerClass]="'pf-data-grid-header'"
                        [style]="{'text-align': col.TextAlign}"
                        [width]="selectedRowId ? null : col.Width"
                        [minResizableWidth]="30">
                        <ng-template kendoGridCellTemplate let-dataItem>
                          <pf-grid-column
                            [columnTemplates]='columnTemplates'
                            [dataItem]='dataItem'
                            [field]= 'col'
                            [fieldName]='mappedFieldName(col)'>
                          </pf-grid-column>
                        </ng-template>
                      </kendo-grid-column>
                    </ng-container>
              </ng-container>
          </kendo-grid-column-group>
      </ng-container> 
      <ng-container *ngIf="showColumn(col)">
        <kendo-grid-column 
          [field]="mappedFieldName(col)"
          [title]="col.DisplayName"
          [headerClass]="'pf-data-grid-header'"
          [style]="{'text-align': col.TextAlign}"
          [width]="selectedRowId ? null : col.Width"
          [minResizableWidth]="30">
          <ng-template *ngIf="(sortDescriptor$ | async) as sortDesc" kendoGridHeaderTemplate let-col >
            <span class="k-link">{{col.title}}</span>
            <span *ngIf="sortDesc.field === col.field" 
              class="k-icon"
              [ngClass]="sortDesc.dir === 'asc' ? 'k-i-sort-asc-sm' : k-i-sort-desc-sm">
            </span>
          </ng-template>
          <ng-template kendoGridCellTemplate let-dataItem>
              <pf-grid-column
                [columnTemplates]='columnTemplates'
                [dataItem]='dataItem'
                [field]= 'col'
                [fieldName]='mappedFieldName(col)'>
              </pf-grid-column>
          </ng-template>
        </kendo-grid-column>
      </ng-container>
    </ng-container>
  </kendo-grid>
</pf-async-container>
