<pf-async-container [loading]="loading$ | async">
  <ng-container *ngIf="customHeaderTemplate" [ngTemplateOutlet]="customHeaderTemplate"></ng-container>
  <kendo-grid
    [data]="data"
    [pageSize]="(pagingOptions$ | async)?.Count"
    [skip]="(pagingOptions$ | async)?.From"
    [pageable]="getPagingBarConfig(gridState$ | async)"
    [scrollable]="compactGrid ? 'none': ''"
    [resizable]="selectedRecordId ? false : true"
    [sortable]="isSortable()"
    [sort]="sortDescriptor$ | async"
    [rowClass]="getRowClasses"
    (pageChange)="onPageChange($event)"
    (sortChange)="onSortChange($event)"
    (cellClick)="onCellClick($event)">
    <kendo-grid-checkbox-column [resizable]="false" *ngIf="enableSelection" [headerClass]="getCheckboxHeaderClass()" [class]="{'pf-grid-checkbox': true}" showSelectAll="true" [width]="34">
      <ng-template kendoGridHeaderTemplate>
        <input kendoGridSelectAllCheckbox id="selectAllCheckboxId"
              [state]="selectAllState$ | async"
              (selectAllChange)="onSelectAllChange($event)">
      </ng-template>
      <ng-template kendoGridCellTemplate let-dataItem="dataItem" let-idx="rowIndex">
        <input type="checkbox"
               [checked]="isChecked((selectedKeys$ | async), dataItem[getSelectedRowPrimaryKey()])"
               (click)="onSelectedKeysChange(dataItem[getSelectedRowPrimaryKey()])">
      </ng-template>
    </kendo-grid-checkbox-column>
    <ng-container *ngFor="let col of (dataFields$ | async)">
      <ng-container *ngIf="col.Group">
          <kendo-grid-column-group
            [title]="col.Group"
            [headerClass]="getGridColumnHeaderClass(col)"
            [locked]="false">
              <ng-container *ngFor="let col of col.Fields">
                  <ng-container *ngIf="showColumn(col)">
                      <kendo-grid-column
                        [field]="mappedFieldName(col)"
                        [title]="col.DisplayName"
                        [headerClass]="getGridColumnHeaderClass(col)"
                        [style]="{
                          'text-align': col.TextAlign,
                          'background-color': backgroundColor ? backgroundColor : '',
                          'padding': '0.25rem 0.25rem',
                          'overflow': 'inherit'}"
                        [class]="getColumnClasses(col)"
                        [width]="selectedRecordId ? null : col.Width"
                        [minResizableWidth]="30">
                        <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                          <pf-grid-column
                            [columnTemplates]='columnTemplates'
                            [dataItem]='dataItem'
                            [rowIndex]='rowIndex'
                            [field]= 'col'
                            [fieldName]='mappedFieldName(col)'>
                          </pf-grid-column>
                        </ng-template>
                      </kendo-grid-column>
                    </ng-container>
              </ng-container>
          </kendo-grid-column-group>

      </ng-container>
      <ng-container *ngIf="showColumn(col)">

        <kendo-grid-column
          [field]="mappedFieldName(col)"
          [title]="col.DisplayName"
          [headerClass]="getGridColumnHeaderClass(col)"
          [style]="{
            'text-align': col.TextAlign,
            'background-color': backgroundColor ? backgroundColor : '',
            'overflow': 'inherit'}"
          [class]="getColumnClasses(col)"
          [width]="selectedRecordId ? null : (col.Width || defaultColumnWidth)"
          [minResizableWidth]="30">
          <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
              <pf-grid-column
                [columnTemplates]='columnTemplates'
                [dataItem]='dataItem'
                [rowIndex]='rowIndex'
                [field]= 'col'
                [fieldName]='mappedFieldName(col)'>
              </pf-grid-column>
          </ng-template>
        </kendo-grid-column>
      </ng-container>
    </ng-container>
    <ng-template *ngIf="noRecordsFound" kendoGridNoRecordsTemplate>
      {{noRecordsFound}}
    </ng-template>
    <div *ngIf="expandedRowTemplate">
      <div *kendoGridDetailTemplate="let dataItem">
        <ng-container
          [ngTemplateOutlet]="expandedRowTemplate"
          [ngTemplateOutletContext]="{dataRow: dataItem}">
        </ng-container>
      </div>
    </div>
    <kendo-grid-command-column *ngIf="rowActionTemplate"
                               [headerClass]="getGridColumnHeaderClass()"
    >
      <ng-template kendoGridCellTemplate let-dataItem="dataItem">
        <ng-container [ngTemplateOutlet]="rowActionTemplate"
                      [ngTemplateOutletContext]="{dataRow: dataItem}"
        >
        </ng-container>
      </ng-template>
    </kendo-grid-command-column>

  </kendo-grid>
</pf-async-container>
