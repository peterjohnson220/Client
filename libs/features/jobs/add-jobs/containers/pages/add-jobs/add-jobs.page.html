<ng-container [ngSwitch]="display">
  <ng-container *ngSwitchCase="'component'" [ngTemplateOutlet]="addJobsContent"></ng-container>
  <ng-container *ngSwitchCase="'modal'">
    <pf-modal-form
      [size]="'xl'"
      [title]="'Add Jobs'"
      [isOpen$]="isAddJobsModalOpen$"
      [centered]="true"
      [showSpinner]="true"
      [modalId]="'au-modal-add-jobs'"
      [allowDismiss]="true"
      [showFooter]="true"
      [primaryButtonText]="'Add' + (numberOfJobsSelected!=0 ? '(' + numberOfJobsSelected + ')': '')"
      (onDismiss)="handleCancelClicked()"
      (onSubmit)="handleAddClicked()"
      [submitEnabled]="false">
      <ng-container basic-content>
        <div class="add-jobs-modal-container">
          <ng-container [ngTemplateOutlet]="addJobsContent"></ng-container>
        </div>
      </ng-container>
    </pf-modal-form>
  </ng-container>
</ng-container>


<ng-template #addJobsContent>
  <pf-search-layout *ngIf="pageShown$ | async" [resultsCount]="isSmallBiz ? null : (numberOfSearchResults$ | async)">

    <ng-container sidebar>

      <div *ngIf="addJobsConfig?.enableCreateNewJobs && !(searchingFilter$ | async) && display === 'component'" [pfSecuredResource]="_Permissions.JOBS_ADD_EDIT_DELETE" class="create-new-job" [attr.data-qa-id]="'btn-createNewJobNav'">
        <div class="search-action" (click)="handleCreateNewJobClicked()">
          <fa-icon [icon]="['far', 'plus']"></fa-icon> Create New Job
        </div>
      </div>

      <pf-search-filters
        [defaultFocusedFilterId]="'jobTitleCode'"
        [visible]="!(searchingFilter$ | async)">
      </pf-search-filters>

      <pf-single-filter
        *ngIf="!!(searchingFilter$ | async)">
      </pf-single-filter>
    </ng-container>

    <ng-container content>

      <pf-results-header></pf-results-header>
      <ng-container *ngIf="display === 'modal'; else jobsSearchResults">
        <pf-async-container
          [loading]="loadingResults$ | async"
          [loadingError]="searchError$ | async"
          [hideReloadButton]="true">
          <ng-container [ngTemplateOutlet]="jobsSearchResults"></ng-container>
        </pf-async-container>
      </ng-container>

      <pf-paymarkets *ngIf="addJobsConfig?.enablePaymarkets" [implementation]="display" [useSmallBizStyles]="isSmallBiz"></pf-paymarkets>

      <pf-job-limit-counter *ngIf="!!isSmallBiz"
                            [jobUsageCount]="jobUsageCount"
                            [numberOfSearchResults]="(numberOfSearchResults$ | async)"
                            [currentJobCountSetting]="currentJobCountSetting"
                            [maxAllowedJobsSetting]="maxAllowedJobsSetting">
      </pf-job-limit-counter>

    </ng-container>

    <ng-container action-buttons >

    <span *ngIf="!(addingDataError$ | async)">
      <button class="btn btn-sm btn-secondary mr-3 clear-selections"
              [attr.data-qa-id]="'btn-clearSelections'"
              [disabled]="numberOfJobsSelected === 0"
              (click)="handleClearSelectionsClicked()">
        Clear Selections
      </button>

      <button class="btn btn-sm legacy-primary-btn mr-3 au-btn-add" *ngIf="legacyImplementation"
              [attr.data-qa-id]="'btn-addJobs'"
              [disabled]="(addingData$ | async)
                          || (numberOfJobsSelected === 0)
                          || (addJobsConfig?.enablePaymarkets && !(selectedPaymarkets$ | async)?.length)"
              (click)="handleAddClicked()">

        <ng-container *ngIf="!(addingData$ | async); else addingData">
          Add
          <span *ngIf="numberOfJobsSelected > 0">
            ({{ numberOfJobsSelected }})
          </span>
        </ng-container>
      </button>

      <button (click)="handleCancelClicked()" *ngIf="legacyImplementation"
              class="btn btn-sm btn-secondary mr-3 au-btn-cancel"
              [attr.data-qa-id]="'btn-cancelAddJobs'">
        Cancel
      </button>

      <button (click)="handleAddAllClicked()"
              class="btn btn-link mr-3 au-btn-addall"
              [attr.data-qa-id]="'btn-addAllJobs'"
              [disabled]="(addingData$ | async)
                          || (numberOfSearchResults$ | async) === 0"
              *ngIf="addJobsConfig?.enableAddAllJobs && legacyImplementation">
        <ng-container *ngIf="legacyImplementation">
          Add All
          <span *ngIf="(numberOfSearchResults$ | async) > 0">
            {{ numberOfSearchResults$ | async }}
          </span>
        </ng-container>
      </button>
    </span>


      <span class="error-adding-jobs text-danger" *ngIf="!!(addingDataError$ | async)">
      {{
        (addingDataErrorMessage$ | async)
          ? (addingDataErrorMessage$ | async)
          : 'Error adding selected job(s).'
        }}
    </span>

    </ng-container>

  </pf-search-layout>
</ng-template>
<ng-template #addingData>
  Adding...
</ng-template>

<ng-template #jobsSearchResults>
  <pf-job-search-results [canSelectJobs]="canSelectJobs"
                         [useSmallBizStyles]="isSmallBiz"
                         [implementation]="display"
                         [customSearchResultsStyle]="addJobsConfig?.enablePaymarkets ? {'width': '67%'} : {}"
                         [showJobBasedRangesJobMetadata]="addJobsConfig?.enableAssignedStructuresMetadata || false"
                         [showJobSourceOrTitle]="addJobsConfig?.enabledJobSourceOrTitle">
  </pf-job-search-results>
</ng-template>
