<h2>Peer Exchange Jobs</h2>
<div class="filters position-relative w-25 d-flex">
  <i class="fas fa-search"></i>
  <pf-input-debounce 
    [delay]="400"
    [(ngModel)]="searchTerm"
    [ngModelOptions]="{standalone: true}"
    [placeholderText]="'Search job title'"
    (valueChanged)="updateSearchFilter($event)"
  >
  </pf-input-debounce>
</div>
<label class="text-uppercase" data-qa-id="lbl-exchange-jobs-total">
  peer exchange jobs: {{ totalPeerExchangeJobs$ | async }} total
</label>
<div class="grid-container position-relative">
  <pf-async-container
    class="h-100"
    [loading]="loading$ | async"
    [loadingError]="loadingError$ | async"
    [loadingErrorMessage]="'Error loading exchange jobs'"
    (reload)="reload()"
  >
    <div 
      class="k-tooltip-container" 
      kendoTooltip 
      showOn="none" 
      [tooltipTemplate]="template" 
      filter=".k-grid td"
      (mouseover)="showTooltip($event)"
    >
      <kendo-grid 
        [data]="peerExchangeJobs$ | async"
        [style.height.%]="100"
        [pageSize]="(gridState$ | async)?.take"
        [skip]="(gridState$ | async)?.skip"
        [sort]="(gridState$ | async)?.sort"
        [filter]="(gridState$ | async)?.filter"
        [sortable]="true"
        [resizable]="true"
        [selectable]="true"
        [pageable]="{ buttonCount: 5, info: true }"
        (dataStateChange)="handleDataStateChange($event)"
        (detailExpand)="handleDetailExpand($event)"
      >
        <kendo-grid-column  field="ExchangeJobTitle" title="Job Title">
          <ng-template kendoGridCellTemplate let-dataItem>
            <div [innerHTML]="dataItem.ExchangeJobTitle | highlightText: searchTerm"></div>
          </ng-template>
        </kendo-grid-column>
        <kendo-grid-column field="ExchangeJobFamily" title="Job Family"></kendo-grid-column>
        <kendo-grid-column field="ExchangeName" title="Exchange Name"></kendo-grid-column>
        <ng-template kendoGridDetailTemplate let-dataItem>
          <p *ngIf="dataItem.ExchangeJobDescription" [innerHTML]="dataItem.ExchangeJobDescription | jobDescriptionParser"></p>
          <p class="font-italic" *ngIf="!dataItem.ExchangeJobDescription">No Job Description Available</p>
        </ng-template>
        <ng-template kendoGridNoRecordsTemplate>
          No results based on your search.
          <a href="javascript:void(0)" (click)="reload(true)">
            <i class="fas fa-redo-alt"></i>Reset now
          </a>
        </ng-template>
      </kendo-grid>
    </div>
  </pf-async-container>
</div>
<ng-template #template let-anchor>
  <span>{{ anchor.nativeElement.innerText }}</span>
</ng-template>
