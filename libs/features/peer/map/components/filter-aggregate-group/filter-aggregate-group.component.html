<div class="aggregate-group"
     *ngIf="!searchingAnotherAggregate"
     [ngClass]="{'collapsed': collapsed, 'searching': searchingThisAggregate}">

  <div class="aggregate-group-header" (click)="collapsed = !collapsed">
    <div class="header-left space-out-children-right">
      <div>
        <input type="checkbox" [ngModel]="allOptionsSelected" (click)="handleSelectAllChecked($event)">
      </div>
      <div>
        {{categoryLabel}}
      </div>
      <div>
        <span class="text-muted" *ngIf="filterOperatorLabel">{{filterOperatorLabel}}</span>
      </div>
      <div class="ml-2" *ngIf="collapsed">
        <fa-icon [icon]="['far', 'angle-down']"></fa-icon>
      </div>
    </div>
    <div class="header-right">
      <div class="reset-link"
           *ngIf="hasSelections"
           [ngClass]="cssResetClearBtnAutomationName"
           (click)="handleResetClicked($event)">
        <ng-container *ngIf="hasSelections">Clear ({{selectionsCount}})</ng-container>
      </div>
      <div class="search"
           [ngClass]=" 'au-btn-search-' + aggregateGroup.MetaData.Id"
           *ngIf="allowedToSearch"
           (click)="handleSearchClicked($event)">
        <fa-icon [icon]="['far', 'search']"></fa-icon>
      </div>
    </div>

  </div>

  <div class="search-filter" *ngIf="searchingThisAggregate">
    <pf-input-debounce
      [ngModel]="searchValue"
      (valueChanged)="handleSearchValueChanged($event)"
      [automationClassName]="'au-txt-search-single-filter-search'">
    </pf-input-debounce>
  </div>

  <!--Options-->
  <div class="aggregate-container">
    <ng-container *ngIf="filterAggregates.length; else noAggregateItems">
      <pf-filter-aggregate
        *ngFor="let filterAggregate of filterAggregates;trackBy: trackById"
        [aggregate]="filterAggregate"
        (aggregateSelected)="handleAggregateSelected($event)">
      </pf-filter-aggregate>
    </ng-container>

    <ng-template #noAggregateItems>
      <div class="pl-3">No Data</div>
    </ng-template>
  </div>

  <!--Options Toggle-->
  <div *ngIf="allowedToSearch"
       (click)="handleSearchClicked($event)"
       class="toggle-option-height">

    Show {{aggregateGroup.Aggregates.length - aggregateGroup.AggregatesPreview.length}} More
    <fa-icon [icon]="['far', 'angle-down']"></fa-icon>

  </div>

</div>
