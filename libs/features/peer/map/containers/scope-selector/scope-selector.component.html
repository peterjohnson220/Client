<div class="scope-selector-container"
     [ngClass]="{'custom-modal-popover custom-modal-arrow': addDataModal, 'custom-map-popover custom-map-arrow scope-selector-no-padding': !addDataModal}">
  <button type="button"
          class="btn btn-secondary selector"
          [disabled]="(exchangeScopeItems$ | async)?.length === 0"
          [ngbPopover]="popContent"
          popoverTitle="Select a Scope"
          [placement]="addDataModal ? 'right' : 'bottom-right'"
          #p="ngbPopover">

    <span class="selector-caret">
      <fa-icon *ngIf="addDataModal" icon="caret-right"></fa-icon>
      <fa-icon *ngIf="!addDataModal" icon="caret-down"></fa-icon>
    </span>

    <span class="selector-label text-muted">Exchange Scope:</span>

    <span class="selection" [title]="(selectedExchangeScopeItem$ | async)?.Name || ''" [class.no-selection]="!(selectedExchangeScopeItem$ | async)">
      {{(selectedExchangeScopeItem$ | async)?.Name || "No Selection"}}
    </span>

  </button>

</div>

<ng-template #popContent>
  <div class="d-flex flex-column h-100">
    <div class="popover-content">

      <div *ngFor="let exchangeScopeItem of exchangeScopeItems$ | async"
          (click)="handleExchangeScopeClicked($event, exchangeScopeItem)"
          class="exchange-scope-selection"
          [class.selected-scope]="itemSelected(exchangeScopeItem) && !deleteMode"
          [class.disabled-scope]="deleteMode"
          [class.highlight-scope]="highlightScope(exchangeScopeItem)"
          >

        <div class="d-flex justify-content-between pl-2">
          <div class="ellipsis-overflowing-text">
            <div [title]="exchangeScopeItem.Name" class="ellipsis-overflowing-text">
              {{exchangeScopeItem.Name}}
            </div>

            <div [title]="exchangeScopeItem.Description == null ? '' : exchangeScopeItem.Description"  class="scope-description small">
              {{(exchangeScopeItem.Description == "" || exchangeScopeItem.Description == null) ? "No Description Provided" : exchangeScopeItem.Description}}
            </div>
          </div>

          <button *ngIf="!addDataModal"
                  [title]="exchangeScopeItem.AssociatedToPaymarket ? 'Unable to delete scope associated to a paymarket.' : 'Delete'"
                  class="btn btn-sm btn-secondary delete-btn mt-2"
                  [disabled]="deleteMode || (exchangeScopeItem.AssociatedToPaymarket == true)"
                  (click)="enterDeleteScopeMode($event, exchangeScopeItem)"
                  [class.disabled]="deleteMode || (exchangeScopeItem.AssociatedToPaymarket == true)">
            <fa-icon icon="trash-alt" aria-hidden="true"></fa-icon>
          </button>
       </div>
      </div>
    </div>
    <div *ngIf="deleteMode" class="popover-footer">
      <button type="button" class="btn btn-sm btn-secondary mr-2" [disabled]="(deletingExchangeScope$ | async)" (click)="cancelDeleteScope($event)">Cancel</button>
      <button type="button" class="btn btn-sm btn-danger" [disabled]="(deletingExchangeScope$ | async)" (click)="deleteScope($event)">
        <span *ngIf="!(deletingExchangeScope$ | async)">Delete</span>
        <span *ngIf="(deletingExchangeScope$ | async)">
          <pf-loading-indicator></pf-loading-indicator> Deleting...
        </span>
      </button>
    </div>
  </div>

</ng-template>
