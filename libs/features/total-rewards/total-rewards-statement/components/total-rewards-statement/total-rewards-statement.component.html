<div *ngIf="statement" class="container statement position-relative" [ngClass]="fontSizeCssClass + ' ' + fontFamilyCssClass">
  <pf-async-container [loading]="loadingData"></pf-async-container>
  <!-- TODO: the effective date should probably be changed over to a control like all the others vs. hardcoded at the top (my bad!) -->
  <div *ngIf="statement?.TemplateName?.toLowerCase() !== 'styled'" class="d-flex justify-content-end">
    <pf-effective-date
      [mode]="mode"
      [effectiveDate]="statement.EffectiveDate"
      (onDateChange)="handleEffectiveDateChange($event)">
    </pf-effective-date>
  </div>
  <div *ngFor="let page of statement.Pages; trackBy: trackByFn" class="pb-4 trs-page">
    <section *ngFor="let section of page.Sections; trackBy: trackByFn" class="row vertical-divider trs-section">
      <div 
        *ngFor="let column of section.Columns; trackBy: trackByFn" 
        [ngClass]="'col-' + column?.Layout?.Width" 
        class="trs-column" 
        pfStatementGraphicsDirective
        [colors]="statement.Settings.Colors" 
        [colorRank]="statement.Settings.DividerColor" 
        [styleAttrToColor]="'borderRightColor'">
        <div *ngIf="(mode === statementModeEnum.Edit) || employeeRewardsData" class="row columnRow">
          <div *ngFor="let control of column.Controls; trackBy: trackByFn" [ngClass]="'col-' + control?.Layout?.Width + ' control-type-' + control.ControlType">

            <pf-trs-rich-text-control *ngIf="control.ControlType === controlType.RichTextEditor"
              [controlData]="control"
              [mode]="mode"
              [employeeRewardsData]="employeeRewardsData"
              (onTitleChange)="handleOnControlTitleChange($event)"
              (onContentChange)="handleOnRichTextControlContentChange($event)"
              class="p-1"></pf-trs-rich-text-control>

            <pf-trs-image-control *ngIf="control.ControlType === controlType.Image"
              [controlData]="control"
              [statementId]="statement.StatementId"
              [mode]="mode"
              (saveImage)="handleSaveImage($event)"
              (removeImage)="handleRemoveImage($event)"
              (imageLoaded)="handleImageLoaded($event)"></pf-trs-image-control>

            <pf-trs-calculation-control
              *ngIf="control.ControlType === controlType.Calculation && visibleCalculationControls.includes(control)"
              [controlData]="control"
              [mode]="mode"
              [employeeRewardsData]="employeeRewardsData"
              [companyUdfs]="companyUdfs"
              [visibleFieldsCount]="visibleFieldsCount"
              [graphicsColors]="statement.Settings.Colors"
              (onTitleChange)="handleOnControlTitleChange($event)"
              (onCompFieldTitleChange)="handleOnCalculationControlCompFieldTitleChange($event)"
              (onUpdateSummaryTitleChange)="handleOnCalculationControlSummaryTitleChange($event)"
              (onCompFieldRemoved)="handleOnCalculationControlCompFieldRemoved($event)"
              (onCompFieldAdded)="handleOnCalculationControlCompFieldAdded($event)"></pf-trs-calculation-control>

            <pf-trs-chart-control *ngIf="control.ControlType === controlType.Chart"
              [controlData]="control"
              [mode]="mode"
              [employeeRewardsData]="employeeRewardsData"
              [calculationControls]="visibleCalculationControls"
              [chartColors]="statement.Settings.Colors"
              (onTitleChange)="handleOnControlTitleChange($event)"
              (settingsClick)="handleChartControlSettingsClick()"
              (chartRender)="handleChartRender()"
              class="p-1"></pf-trs-chart-control>

            <pf-trs-title-control *ngIf="control.ControlType === controlType.Title"
              [controlData]="control"
              [mode]="mode"
              [employeeRewardsData]="employeeRewardsData"
              [backgroundGraphicsEnabled]="control.EnableBackgroundGraphics"
              [graphicsColors]="statement.Settings.Colors"
              [showEmployee]="control.ShowEmployee"
              [titleInnerWidth]="control.TitleInnerWidth"
              (titleChange)="handleOnControlTitleChange($event)"
            ></pf-trs-title-control>

            <pf-trs-summary-control *ngIf="control.ControlType === controlType.CalculationSummary"
              [mode]="mode"
              [controlData]="control"
              [employeeRewardsData]="employeeRewardsData"
              [calculationControls]="visibleCalculationControls"
              [graphicsColors]="statement.Settings.Colors"
              (onTitleChange)="handleOnControlTitleChange($event)"
              class="p-1"></pf-trs-summary-control>

            <pf-trs-employee-control *ngIf="control.ControlType === controlType.Employee"
              [mode]="mode"
              [controlData]="control"
              [employeeRewardsData]="employeeRewardsData"
              [graphicsColors]="statement.Settings.Colors">
            </pf-trs-employee-control>

          </div>
        </div>
      </div>
    </section>
    <span *ngIf="pageBreakAfter" class="page-break"></span>
  </div>
</div>
