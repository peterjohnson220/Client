<div *ngIf="statement" class="container statement mb-4" [ngClass]="fontSizeCssClass + ' ' + fontFamilyCssClass">
  <pf-async-container [loading]="loadingData"></pf-async-container>
  <!-- TODO: the effective date should probably be changed over to a control like all the others vs. hardcoded at the top (my bad!) -->
  <div *ngIf="statement?.TemplateName?.toLowerCase() !== 'styled'" class="d-flex justify-content-end">
    <pf-effective-date
      [mode]="mode"
      [effectiveDate]="statement.EffectiveDate"
      (onDateChange)="handleEffectiveDateChange($event)">
    </pf-effective-date>
  </div>
  <div *ngFor="let page of statement.Pages; trackBy: trackByFn" class="pb-4 trs-page mt-n4">
    <section *ngFor="let section of page.Sections; trackBy: trackByFn" class="row vertical-divider trs-section">
      <div *ngFor="let column of section.Columns; trackBy: trackByFn" [ngClass]="'col-' + column?.Layout?.Width" class="trs-column" [style.border-right-color]="statement.Settings.DividerColor">
        <div *ngIf="(mode === statementModeEnum.Edit) || employeeRewardsData" class="row columnRow">
          <div *ngFor="let control of column.Controls; trackBy: trackByFn" [ngClass]="'col-' + control?.Layout?.Width + ' control-type-' + control.ControlType">
            <div *ngIf="control.ControlType === controlType.RichTextEditor">
              <pf-trs-rich-text-control
                [controlData]="control"
                [mode]="mode"
                [employeeRewardsData]="employeeRewardsData"
                (onTitleChange)="handleOnControlTitleChange($event)"
                (onContentChange)="handleOnRichTextControlContentChange($event)"
                class="p-1"></pf-trs-rich-text-control>
            </div>

            <div *ngIf="control.ControlType === controlType.Image">
              <pf-trs-image-control
                [controlData]="control"
                [statementId]="statement.StatementId"
                [mode]="mode"
                (saveImage)="handleSaveImage($event)"
                (removeImage)="handleRemoveImage($event)"
                (imageLoaded)="handleImageLoaded($event)"
                class="p-1"></pf-trs-image-control>
            </div>

            <div *ngIf="control.ControlType === controlType.Calculation && visibleCalculationControls.includes(control)">
              <pf-trs-calculation-control
                [controlData]="control"
                [mode]="mode"
                [employeeRewardsData]="employeeRewardsData"
                [companyUdfs]="companyUdfs"
                [visibleFieldsCount]="visibleFieldsCount"
                (onTitleChange)="handleOnControlTitleChange($event)"
                (onCompFieldTitleChange)="handleOnCalculationControlCompFieldTitleChange($event)"
                (onUpdateSummaryTitleChange)="handleOnCalculationControlSummaryTitleChange($event)"
                (onCompFieldRemoved)="handleOnCalculationControlCompFieldRemoved($event)"
                (onCompFieldAdded)="handleOnCalculationControlCompFieldAdded($event)"></pf-trs-calculation-control>
            </div>

            <div *ngIf="control.ControlType === controlType.Chart">
              <pf-trs-chart-control
                [controlData]="control"
                [mode]="mode"
                [employeeRewardsData]="employeeRewardsData"
                [calculationControls]="visibleCalculationControls"
                [chartColors]="statement.Settings.ChartColors"
                (onTitleChange)="handleOnControlTitleChange($event)"
                (settingsClick)="handleChartControlSettingsClick()"
                (chartRender)="handleChartRender($event)"
                class="p-1"></pf-trs-chart-control>
            </div>

            <div *ngIf="control.ControlType === controlType.Title">
              <pf-trs-title-control
                [controlData]="control"
                [mode]="mode"
                [employeeRewardsData]="employeeRewardsData"
                [backgroundGraphicsEnabled]="control.EnableBackgroundGraphics"
                [showEmployee]="control.ShowEmployee"
                [titleInnerWidth]="control.TitleInnerWidth"
                (titleChange)="handleOnControlTitleChange($event)"
                class="p-1"></pf-trs-title-control>
            </div>

            <div *ngIf="control.ControlType === controlType.CalculationSummary">
              <pf-trs-summary-control
                [mode]="mode"
                [controlData]="control"
                [employeeRewardsData]="employeeRewardsData"
                [calculationControls]="visibleCalculationControls"
                (onTitleChange)="handleOnControlTitleChange($event)"
                class="p-1"></pf-trs-summary-control>
            </div>
          </div>
        </div>
      </div>
    </section>
    <span *ngIf="pageBreakAfter" class="page-break"></span>
  </div>
</div>
