<div class="trs-calculation container py-2" [ngClass]="inEditMode ? 'edit-mode' : inPreviewMode ? 'preview-mode' : ''">
  <table class="table table-borderless table-sm mb-0 w-100">
    <colgroup>
      <col class="field-column">
      <col class="contribution-column">
      <col class="button-column">
    </colgroup>
    <thead>
      <tr class="trs-calculation-row w-100">
        <th class="text-left font-weight-normal" scope="col">
          <h4 class="primary-control-heading mb-1">
            <pf-string-editor
              [value]="controlData.Title.Override"
              [placeholder]="controlData.Title.Default"
              [maxCharacters]="30"
              [inEditMode]="inEditMode"
              (valueChange)="onControlTitleChange($event)"></pf-string-editor>
          </h4>
        </th>
        <th class="text-right pb-3" scope="col" class="secondary-header align-middle text-right font-weight-normal">Contribution</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let listItem of controlData.DataFields; let i = index " class="trs-calculation-row w-100">
        <ng-template *ngIf="displayFieldInTable(listItem); then includeField;"></ng-template>
        <ng-template #includeField>
          <td class="text-left" [class.last-before-summary]="controlData.DataFields.length - 1 === i">
            <pf-string-editor
              [value]="listItem.Name.Override"
              [placeholder]="listItem.Name.Default"
              [maxCharacters]="30"
              [inEditMode]="inEditMode"
              (valueChange)="onCompFieldNameChange(listItem, $event)"></pf-string-editor>
          </td>
          <td class="contribution-field text-right" [ngClass]="inPreviewMode ? 'preview-mode-animation' : '' ">
            {{getEmployerContributionValue(listItem.DatabaseField)}}
          </td>
          <td *ngIf="inEditMode">
            <button type="button" class="remove-btn btn btn-sm btn-outline-danger" (click)="removeField(listItem)">
              <fa-icon class="fa-sm" [icon]="'trash-alt'"></fa-icon>
            </button>
          </td>
        </ng-template>
      </tr>
      <tr class="trs-calculation-row w-100">
        <td class="summary text-left">
          <pf-string-editor
            [value]="controlData.Summary.Override"
            [placeholder]="controlData.Summary.Default"
            [maxCharacters]="30"
            [inEditMode]="inEditMode"
            (valueChange)="onSummaryTitleChange($event)"></pf-string-editor>
        </td>
        <td class="contribution-field summary text-right" [ngClass]="inPreviewMode ? 'preview-mode-animation' : '' ">
          {{getSummaryValue()}}
        </td>
        <td></td>
      </tr>
    </tbody>
  </table>

  <ng-container *ngIf="inEditMode && (selectableFields?.length > 0)">
    <pf-trs-compensation-fields-chooser [fields]="selectableFields"
                                        [maxVisibleFieldsReached]="maxVisibleFieldsReached"
                                        (fieldClicked)="addField($event)">
    </pf-trs-compensation-fields-chooser>
  </ng-container>

</div>
