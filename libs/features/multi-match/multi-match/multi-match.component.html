<ng-container [ngSwitch]="display">
  <ng-container *ngSwitchCase="'component'" [ngTemplateOutlet]="multiMatchContent"></ng-container>
  <ng-container *ngSwitchCase="'modal'">
    <pf-modal-form
      [size]="'xl'"
      [modalId]="'au-modal-multi-match'"
      [isOpen$]="showMultiMatchModal$"
      [showFooter]="true"
      [showFooterActions]="!(refiningPeerCut$ | async)"
      [title]="'Price Jobs'"
      [primaryButtonText]="'Save'"
      [windowClass]="'multi-match-modal'"
      (onDismiss)="handleCancelClicked()"
      (onSubmit)="handleSaveClicked()"
      [showSpinner]="true"
      [submitEnabled]="!(savingChanges$ | async)"
      [primaryButtonTextSubmitting]="'Saving'"
      [submitting]="saveChangesStarted"
    >
      <ng-container basic-content>
        <div class="multi-match-modal-body-container">
          <ng-container [ngTemplateOutlet]="multiMatchContent"></ng-container>
        </div>
      </ng-container>
    </pf-modal-form>
  </ng-container>
</ng-container>

<ng-template #savingChanges>
  Saving...
</ng-template>

<ng-template #multiMatchContent>
  <div *ngIf="hasError && display=='modal'" class="alert alert-danger">
    Something went wrong. Please try again later.
  </div>
  <div *ngIf="!hasError && display=='modal'" class="alert alert-info">
    {{(refiningPeerCut$ | async) ?
    'Filter the data to create a custom cut. Once the data is filtered, click "Add" to make this custom cut available ' +
    'to drag-and-drop to the company jobs.' :
    'Select one or more data cuts. Drag and drop the selected cuts onto a Company Job to the right. ' +
    'Once complete, click "Save" to create the pricing.'}}
  </div>
  <div class="multi-match-content">
    <pf-search-layout [resultsCount]="numberOfResults$ | async" [ngClass]="{'d-none': (refiningPeerCut$ | async)}">
      <ng-container sidebar>
        <pf-search-filters
          [defaultFocusedFilterId]="'jobTitleCode'"
          [visible]="!(searchingFilter$ | async)">
        </pf-search-filters>

        <pf-single-filter
          *ngIf="searchingFilter$ | async">
        </pf-single-filter>
      </ng-container>

      <ng-container content>
        <pf-results-header
          *ngIf="pageShown$ | async"
          [userFilterDefaultLabel]="'PayMarket Default'"
          [legacyImplementation]="display === 'component'"
        ></pf-results-header>
        <ng-container *ngIf="display === 'modal'; else searchResultsAndJobs">
          <pf-async-container
            [loading]="loadingResults$ | async"
            [loadingError]="searchError$ | async"
            [hideReloadButton]="true"
          >
            <ng-container [ngTemplateOutlet]="searchResultsAndJobs"></ng-container>
          </pf-async-container>
        </ng-container>
      </ng-container>

      <ng-container action-buttons *ngIf="display !== 'modal'">
        <button [disabled]="!changesToSave || (savingChanges$ | async)" (click)="handleSaveClicked()" class="btn btn-sm legacy-primary-btn mr-3">
          <ng-container *ngIf="!(savingChanges$ | async); else savingChanges">
            Save
          </ng-container>
        </button>

        <button (click)="handleCancelClicked()" class="btn btn-sm btn-secondary mr-3">
          Cancel
        </button>
      </ng-container>
    </pf-search-layout>
    <pf-upsert-peer-data-cut
      [ngClass]="{'d-none': !(refiningPeerCut$ | async)}"
      (refinedDataCutDetails)="handleExchangeDataCutRefined($event)"
      (cancelChanges)="handleRefineCancelled()"></pf-upsert-peer-data-cut>
  </div>
</ng-template>

<ng-template #searchResultsAndJobs>
  <pf-survey-search-results
    [cutsDraggable]="true"
    [implementation]="display"
    [refineInPeerEnabled]="customizeScopeInMultimatchModalFlag.value"
    [refineInPeerReadyDefault]="true"
  ></pf-survey-search-results>
  <pf-jobs-to-price-container
    [featureImplementation]="featureImplementation"
  ></pf-jobs-to-price-container>
</ng-template>
