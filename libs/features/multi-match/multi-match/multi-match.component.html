<ng-container [ngSwitch]="display">
  <ng-container *ngSwitchCase="'component'" [ngTemplateOutlet]="multiMatchContent"></ng-container>
  <ng-container *ngSwitchCase="'modal'">
    <pf-modal-form
      [size]="'xl'"
      [modalId]="'au-modal-multi-match'"
      [isOpen$]="showMultiMatchModal$"
      [showFooter]="true"
      [title]="'Price Jobs'"
      [primaryButtonText]="'Save'"
      [windowClass]="'multi-match-modal'"
      (onDismiss)="handleCancelClicked()"
      (onSubmit)="handleSaveClicked()"
      [showSpinner]="true"
      [submitEnabled]="!(savingChanges$ | async)"
      [primaryButtonTextSubmitting]="'Saving'"
      [submitting]="saveChangesStarted"
    >
      <ng-container basic-content>
        <div class="multi-match-modal-body-container">
          <ng-container [ngTemplateOutlet]="multiMatchContent"></ng-container>
        </div>
      </ng-container>
    </pf-modal-form>
  </ng-container>
</ng-container>

<ng-template #savingChanges>
  Saving...
</ng-template>

<ng-template #multiMatchContent>
  <div *ngIf="hasError && display=='modal'" class="alert alert-danger">
    Something went wrong. Please try again later.
  </div>
  <div *ngIf="!hasError && display=='modal'" class="alert alert-info">
    Select one or multiple cuts from your search results by clicking anywhere in the cut.
    Drag and drop in the company job in the right hand panel to add those cuts to that job. Once you have added your cuts, click Save to create the pricing.
  </div>
<!--  TODO: Come up with a better way to handle refining here, doesn't really make sense here [JP]-->
  <div *ngIf="!(refiningPeerCut$ | async); else refineScopeMap" class="multi-match-content">
    <pf-search-layout [resultsCount]="numberOfResults$ | async">
      <ng-container sidebar>
        <pf-search-filters
          [defaultFocusedFilterId]="'jobTitleCode'"
          [visible]="!(searchingFilter$ | async)">
        </pf-search-filters>

        <pf-single-filter
          *ngIf="searchingFilter$ | async">
        </pf-single-filter>
      </ng-container>

      <ng-container content>
        <pf-results-header
          *ngIf="pageShown$ | async"
          [userFilterDefaultLabel]="'PayMarket Default'"
          [legacyImplementation]="display === 'component'"
        ></pf-results-header>
        <ng-container *ngIf="display === 'modal'; else searchResultsAndJobs">
          <pf-async-container
            [loading]="loadingResults$ | async"
            [loadingError]="searchError$ | async"
            [hideReloadButton]="true"
          >
            <ng-container [ngTemplateOutlet]="searchResultsAndJobs"></ng-container>
          </pf-async-container>
        </ng-container>
      </ng-container>

      <ng-container action-buttons *ngIf="display !== 'modal'">
        <button [disabled]="!changesToSave || (savingChanges$ | async)" (click)="handleSaveClicked()" class="btn btn-sm legacy-primary-btn mr-3">
          <ng-container *ngIf="!(savingChanges$ | async); else savingChanges">
            Save
          </ng-container>
        </button>

        <button (click)="handleCancelClicked()" class="btn btn-sm btn-secondary mr-3">
          Cancel
        </button>
      </ng-container>
    </pf-search-layout>
  </div>
</ng-template>

<ng-template #searchResultsAndJobs>
  <pf-survey-search-results
    [cutsDraggable]="true"
    [implementation]="display"
    [refineInPeerEnabled]="customizeScopeInMultimatchModalFlag.value"
    [refineInPeerReadyDefault]="true"
  ></pf-survey-search-results>
  <pf-jobs-to-price-container
    [featureImplementation]="featureImplementation"
  ></pf-jobs-to-price-container>
</ng-template>

<ng-template #refineScopeMap>
  <pf-upsert-peer-data-cut
    [entityConfiguration]="entityConfiguration"
    [companyJobId]="-1"
    [companyPayMarketId]="companyPayMarketId"
  ></pf-upsert-peer-data-cut>
</ng-template>
